<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>【Docker 学习十】DockerFile | 鱼六秒</title><meta name="keywords" content="Docker"><meta name="author" content="鱼六秒"><meta name="copyright" content="鱼六秒"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="【Docker 学习十】DockerFile"><meta name="application-name" content="【Docker 学习十】DockerFile"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="【Docker 学习十】DockerFile"><meta property="og:url" content="http://blog.sunguotao.shop/posts/eb2df35a.html"><meta property="og:site_name" content="鱼六秒"><meta property="og:description" content="体验一下创建dockerfile01文件先创建一个dockerfile文件，名字可以随便命令，但建议就用dockerfile 1vi &amp;#x2F;home&amp;#x2F;dockerfile_01 通过这脚本可以生成镜像，镜像就是一层一层的，脚本一个个命令，每个命令都是一层  编写dockerfile01123456789"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="http://blog.sunguotao.shop/img/bg.jpg"><meta property="article:author" content="鱼六秒"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://blog.sunguotao.shop/img/bg.jpg"><meta name="description" content="体验一下创建dockerfile01文件先创建一个dockerfile文件，名字可以随便命令，但建议就用dockerfile 1vi &amp;#x2F;home&amp;#x2F;dockerfile_01 通过这脚本可以生成镜像，镜像就是一层一层的，脚本一个个命令，每个命令都是一层  编写dockerfile01123456789"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://blog.sunguotao.shop/posts/eb2df35a"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2023/09/03/125766904/ee23df8517f3c3e3efc4145658269c06_5714860933110284659.png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: undefined,
  LA51: undefined,
  greetingBox: {"enable":true,"default":"晚上好👋","list":null},
  twikooEnvId: '',
  commentBarrageConfig:{"enable":true,"maxBarrage":1,"barrageTime":8000,"accessToken":"","mailMd5":""},
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: false,
  mainTone: undefined,
  authorStatus: undefined,
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: true
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: 鱼六秒","link":"链接: ","source":"来源: 鱼六秒","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '鱼六秒',
  title: '【Docker 学习十】DockerFile',
  postAI: '',
  pageFillDescription: '体验一下, 创建dockerfile01文件, 编写dockerfile01, 构建镜像：docker build命令, 用法, docker build命令, 启动自己写的容器, 用法, 运行容器, 查看数据卷, 退出容器并查看Mounts, 测试一下：宿主机和容器的文件是否同步了, 创建container.txt文件, 查看宿主机volume01目录路径, 切换路径后用ls查看, 初识Dockerfile, Dockerfile构建过程, 基础知识, dockerfile指令, FROM, MAINTAINER, LABEL, RUN, CMD, 命令, ENTRYPOINT, EXPOSE, ENV, ADD, COPY, VOLUME, WORKDIR, USER, ARG, 语法, ARG 变量应用, 实战测试, 创建一个自己的centos, 通过这个文件构建镜像, 查看镜像, 运行容器, 列出本地进行的变更历史体验一下创建文件先创建一个文件名字可以随便命令但建议就用通过这脚本可以生成镜像镜像就是一层一层的脚本一个个命令每个命令都是一层编写文件中的内容指令都是大写参数镜像匿名挂载容器内部的路径这里的每个命令都是镜像的一层构建镜像命令用法文件所在位置镜像名称可以说自定义版本号当前路径命令略命令行后面要加否则报错了注意这里的表示在当前路径实际上指的是在指定上下文目录命令会将该目录下的内容打包交给引擎以帮助构建镜像启动自己写的容器用法镜像运行容器查看数据卷说明这个目录就是我们生成镜像的时候自动挂载了数据卷目录退出容器并查看这个卷和宿主机都有一个同步的目录匿名挂载一般都是放在宿主机里面目录路径下测试一下宿主机和容器的文件是否同步了首先在自己的容器目录下创建文件创建文件查看宿主机目录路径退出容器之后查看有没有同步了如果不知道此路径可以通过命令容器查看内容切换路径后用查看说明文件同步了这种方式以后使用太多了因为我们通常会构建自己的镜像假如构建镜像时候没有挂载卷要手动镜像挂载卷名容器内路径初识命令脚本构建镜像启动容器查看就是用来构建镜像的构建文件和命令脚本它就是一个命令脚本的文本文件文本内容包含了一条条构建镜像所需的指令和说明基于构建镜像可以使用命令命令中使用可以指定具体的文件默认情况下使用大写命令中不用指定就可以构建构建步骤编写一个文件构建成为一个镜像运行镜像发布镜像阿里云镜像仓库很多官方镜像都像是基础包很多功能都不具备我们通常会自己搭建自己的镜像官方既然可以制作镜像我们也一样可以做构建过程基础知识每个保留关键字指令都是必须大写字母执行从上到下顺序执行表示注释每个指令都会创建提交一个新的镜像层并提交是面向开发的我们以后要发布项目做镜像就需要编写文件这个文件十分简单镜像逐渐成为企业的交互标准必须要掌握步骤开发部署运维缺一不可构建文件定义了一切的步骤源代码通过构建生成的镜像最终发布和运行的产品文件路径名称标签容器容器就是镜像运行起来提供服务器指令以前的话我们就是使用别人的现在我们知道了这些指令之后我们可以来练习自己写一个镜像参数含义基础镜像一切从这里开始构建镜像是谁写的姓名邮箱添加镜像的元数据使用键值对的形式镜像构建的时候需要运行的命令指定这个容器启动时运行的命令例只有最后一个会生效可被替代可以被覆盖指定这个容器启动的时候要运行的命令可以追加命令不可被覆盖暴露的端口构建的时候设置环境变量将文件目录或远程复制到镜像中类似将我们的文件拷贝到镜像中挂载的目录镜像的工作目录指定后续指令的用户上下文定义在构建过程中传递给构建器的变量可使用命令设置当构建一个被继承的的时候就会运行的指令触发指令了解即可设置发送给容器以退出的系统调用信号定义周期性检查容器健康状态的命令覆盖中默认的用于和指令基础镜像必须是可以下载下来的定制的镜像都是基于的镜像比如用于就是定制需要的基础镜像后续的操作都是基于镜像格式示例默认版本号都是最新的指定版本号用于指定镜像的维护者信息格式示例用于向镜像添加元数据指令用来给镜像添加一些元数据这些标签可以包含关于镜像的信息如作者版本描述维护者等指令是可选的但它在构建镜像时为镜像添加了有用的描述性信息有助于更好地管理和组织镜像库以键值对的形式格式示例如果要查看镜像的可以使用命令使用指令有更广泛的用途可以用来添加更多类型的元数据信息而指令仅限于指定维护者信息因此如果你正在编写新的建议使用指令来添加元数据信息而避免使用过时的指令指定在构建正在创建的映像比如安装软件下载文件等包含两种模式和格式模式这个是最常用的需要记住示例指令在中可以出现多次并且每个指令都会创建一个新的镜像层为了减少镜像的层数可以将多个命令合并为一行例如使用连接多个命令这样在构建镜像时只会生成一个新的层用于执行镜像构建容器时使用与不同它不会为创建新层而只是运行命令每个只能有一个一个中只能包含一个指令如果有多个则只有最后一个指令会生效格式该格式是为提供使用此时就必须使用格式否则不生效格式示例命令此命令会在容器启动且没有指定其他命令时运行下面是一个例子运行容器将输出但当后面加上一个命令比如会被忽略掉命令将被执行类似于指令用于运行程序但二者运行的时间点不同在时运行是在构建镜像时运行的作用为启动的容器指定默认要运行的程序程序运行结束容器也就结束指令指定的程序可被命令行参数中指定要运行的程序所覆盖使用指令可以为镜像定义一个默认的启动命令当使用命令启动容器时如果没有指定其他命令就会执行中定义的命令这使得在创建容器时无需手动指定要运行的命令从而使容器的使用更加简便如果在命令中指定了其他命令则会覆盖指令中的默认命令例如如果在启动容器时执行以下命令就会覆盖中定义的默认启动命令文件里面其中在上面的例子中容器会运行命令而不是默认的指令中定义的命令是中的一个重要指令用于配置容器启动时的默认执行命令它类似于指令但有一些关键的区别指令的格式与指令类似可以使用格式或数组格式但在使用时需要注意以下几点指令的命令会在容器启动时始终执行无论在命令中是否指定了其他命令它不会被覆盖而是作为容器的主要执行命令如果在命令中指定了其他命令这些命令将作为指令的参数进行传递也就是说指令中的命令将成为执行时的前缀注意如果中如果存在多个指令仅最后一个生效下面是一个使用指令的简单示例如果我们构建该镜像并运行容器不提供其他参数那么容器启动后将输出如果我们在运行容器时提供了其他参数那么这些参数将作为指令中命令的参数将修改为当容器通过启动时输出为而如果通过启动输出依旧为中的参数始终会被使用而的额外参数可以在容器启动时动态替换掉和可以联合使用设置执行的命令传递参数中和都能够用于执行命令下面是三者的主要用途命令执行命令并创建新的镜像层通常用于安装软件包命令设置容器启动后默认执行的命令及其参数但设置的命令能够被命令后面的命令行参数替换配置容器启动时的执行命令不会被忽略一定会被执行即使运行时指定了其他命令实际应用中可以使用指令来定义一个可执行的程序或脚本然后在容器启动时运行这个程序并将容器作为可执行应用来使用这样可以确保容器在运行时的行为是可预期的而且可以将容器配置和执行逻辑完全封装在镜像内部使得容器的使用更加方便和易于管理用于声明容器在运行时监听的网络端口作用帮助镜像使用者理解这个镜像服务的守护端口以方便配置映射在运行时使用随机端口映射时也就是时会自动随机映射的端口可以是一个或者多个端口也可以指定多个格式端口端口示例上面的例子中我们声明了容器将监听端口而则表示可选的协议类型例如或等但是需要注意的是并不会实际上打开该端口也不会进行端口映射在使用命令启动容器时如果需要通过主机访问容器的端口还需要使用选项来进行端口映射例子上述命令将容器的端口映射到主机的端口这样就可以通过访问主机的端口来访问容器的服务用于设置环境变量它允许在镜像构建过程中设置环境变量这些环境变量将在容器运行时可用格式其中是环境变量的名称是环境变量的值示例实例可以使用多个指令来设置多个环境变量设置环境变量创建目录并设置工作目录复制应用程序到镜像中在运行时输出环境变量我们使用了两个指令来设置两个环境变量和在镜像构建过程中这些环境变量会被设置为指定的值然后在容器启动时指令中的命令将使用环境变量的值输出问候语在运行容器时你可以通过命令的选项来覆盖环境变量的值上述命令将覆盖默认的环境变量值容器将输出用于将文件目录或远程复制到镜像中它类似于指令但在功能上更强大格式是要复制的源文件目录或是复制后的目标路径示例除了复制文件和目录指令还支持自动解压缩如果是一个压缩文件例如等那么指令会自动解压缩该文件到指定的目录实例复制本地文件到镜像中复制本地目录到镜像中从远程下载文件并复制到镜像中解压缩压缩文件并复制到镜像中用于将本地文件或目录复制到镜像中它不支持自动解压缩功能与指令相比功能更简单明确格式是要复制的源文件目录是复制后的目标路径示例复制本地文件到镜像中复制本地目录到镜像中指令会将本地文件或目录复制到镜像中的指定位置在构建镜像时将会在镜像的文件系统层中添加复制的文件或目录这使得镜像的构建过程更加明确不会产生自动解压缩的不确定行为相对于指令指令更为推荐特别是在只需要简单复制本地文件或目录的情况下指令功能简单不容易引起不必要的意外行为对于大多数复制文件的场景建议使用指令用于声明容器中的挂载点数据卷在启动容器的时候我们可以通过参数修改挂载点可以在一个中使用多个指令来声明多个挂载点格式路径路径路径其中路径是挂载点的路径示例声明两个挂载点在运行容器时可以使用选项或选项来将主机的目录或数据卷映射到容器的挂载点例如上述命令将主机的和目录分别映射到容器中的和挂载点实现了主机和容器之间的数据共享用于设置工作目录也称为当前工作目录在容器启动时进程的当前工作目录将被设置为指令所指定的目录必须是提前创建好的格式工作目录路径示例当容器启动时进程的当前工作目录将自动设置为这样在执行指令时不需要使用绝对路径来运行用于指定在容器中运行镜像时要使用的普通用户这边只是切换后续命令执行的用户用户和用户组必须提前已经存在格式用户名用户组示例默认情况下容器在启动时以用户身份运行这意味着容器内的进程具有最高权限然而为了加强安全性避免潜在的安全风险最好以非特权用户的身份运行容器中的应用程序实例创建一个新用户并切换到该用户设置工作目录复制应用程序到工作目录设置环境变量容器启动时运行的命令在上面的例子中我们使用命令创建了一个名为的新用户并使用选项指定了创建用户时使用的然后通过指令切换到了用户这样在容器运行时进程将以用户的身份运行而不是以用户身份无论何种编程语言或脚本中都不可避免的会应用到变量用于定义变量仅在建造当前镜像的过程中包括和有效而要是镜像被创建了和运行容器之后是作用失效了语法格式示例如果你在中使用了但并未给定初始值则在运行编译的时候未指定该变量则会失败若指令具有默认值并且在构建时没有传递值则构建器将使用默认值虽然其在容器启动后不再生效但是不建议使用构建时变量来传递诸如密钥用户凭据等机密信息因为使用命令镜像的任何用户都可以看到构建时的变量值变量应用可以使用和指令为指令指定参数使用指令定义的环境变量会覆盖指令定义的同名变量实战测试创建一个自己的编写文件基于镜像创建镜像是谁写的名字邮箱设置环境路径切换到当前工作目录安装编辑器安装命令暴露端口通过这个文件构建镜像文件路径镜像名如果报错信息给配置时出现原因是因为默认拉取的是最新版此时需要我们指定一下拉取的版本就比如解决问题在我们的文件中编写基于镜像创建镜像是谁写的名字邮箱设置环境路径切换到当前工作目录安装编辑器安装命令暴露端口查看镜像运行容器这个原生和上面自己的镜像对比进去之后是根目录没有列出本地进行的变更历史',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-12-04 17:41:44',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/tools/tools_v2.css" media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 7.1.1"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://pan.anzhiy.cn/" title="alist文件管理"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="alist文件管理"/><span class="back-menu-item-text">alist文件管理</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blogtoolstation.github.io/" title="鱼六秒导航工具站"><img class="back-menu-item-icon" src="https://image.anheyu.com/favicon.ico" alt="鱼六秒导航工具站"/><span class="back-menu-item-text">鱼六秒导航工具站</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">鱼六秒</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/tools/"><span> 在线工具</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 我的装备</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Dart/" style="font-size: 1.05rem;">Dart<sup>3</sup></a><a href="/tags/Docker/" style="font-size: 1.05rem;">Docker<sup>14</sup></a><a href="/tags/FastAPI/" style="font-size: 1.05rem;">FastAPI<sup>1</sup></a><a href="/tags/Hexo/" style="font-size: 1.05rem;">Hexo<sup>8</sup></a><a href="/tags/PDM/" style="font-size: 1.05rem;">PDM<sup>1</sup></a><a href="/tags/PicGo/" style="font-size: 1.05rem;">PicGo<sup>1</sup></a><a href="/tags/npm/" style="font-size: 1.05rem;">npm<sup>1</sup></a><a href="/tags/python/" style="font-size: 1.05rem;">python<sup>1</sup></a><a href="/tags/%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8/" style="font-size: 1.05rem;">云服务器<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">四月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">26</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/08/"><span class="card-archive-list-date">八月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/03/"><span class="card-archive-list-date">三月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/Docker/" itemprop="url">Docker</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/Docker/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Docker</span></a></span></div></div><h1 class="post-title" itemprop="name headline">【Docker 学习十】DockerFile</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2024-04-03T08:50:43.076Z" title="发表于 2024-04-03 16:50:43">2024-04-03</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2023-12-04T09:41:44.525Z" title="更新于 2023-12-04 17:41:44">2023-12-04</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">5.9k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>21分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="【Docker 学习十】DockerFile"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为合肥"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>合肥</span><span class="post-meta-separator"></span><span class="post-meta-commentcount"><i class="anzhiyufont anzhiyu-icon-comments post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/posts/eb2df35a.html#post-comment" tabindex="-1"><span id="twikoo-count"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></a></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="/img/bg.jpg"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://blog.sunguotao.shop/posts/eb2df35a.html"><header><a class="post-meta-categories" href="/categories/Docker/" itemprop="url">Docker</a><a href="/tags/Docker/" tabindex="-1" itemprop="url">Docker</a><h1 id="CrawlerTitle" itemprop="name headline">【Docker 学习十】DockerFile</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">鱼六秒</span><time itemprop="dateCreated datePublished" datetime="2024-04-03T08:50:43.076Z" title="发表于 2024-04-03 16:50:43">2024-04-03</time><time itemprop="dateCreated datePublished" datetime="2023-12-04T09:41:44.525Z" title="更新于 2023-12-04 17:41:44">2023-12-04</time></header><h2 id="体验一下"><a href="#体验一下" class="headerlink" title="体验一下"></a>体验一下</h2><h3 id="创建dockerfile01文件"><a href="#创建dockerfile01文件" class="headerlink" title="创建dockerfile01文件"></a>创建dockerfile01文件</h3><p>先创建一个<code>dockerfile文件</code>，名字可以随便命令，但建议就用<code>dockerfile</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /home/dockerfile_01</span><br></pre></td></tr></table></figure>
<div class="note success no-icon flat"><p>通过这脚本可以生成镜像，<br>镜像就是一层一层的，脚本一个个命令，每个命令都是一层</p>
</div>
<h3 id="编写dockerfile01"><a href="#编写dockerfile01" class="headerlink" title="编写dockerfile01"></a>编写dockerfile01</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 文件中的内容指令(都是大写)参数</span></span><br><span class="line"><span class="comment"># ubuntu镜像</span></span><br><span class="line">FROM centos             </span><br><span class="line"><span class="comment"># 匿名挂载，容器内部的路径</span></span><br><span class="line">VOLUME [<span class="string">&quot;volume01&quot;</span>,<span class="string">&quot;volume02&quot;</span>] </span><br><span class="line"></span><br><span class="line">CMD <span class="built_in">echo</span> <span class="string">&quot;---------end-------&quot;</span></span><br><span class="line">CMD /bin/bash</span><br><span class="line"><span class="comment"># 这里的每个命令都是镜像的一层</span></span><br></pre></td></tr></table></figure>
<h3 id="构建镜像：docker-build命令"><a href="#构建镜像：docker-build命令" class="headerlink" title="构建镜像：docker build命令:"></a>构建镜像：<code>docker build</code>命令:</h3><h4 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -f Dockerfile文件所在位置 -t 镜像名称:tag【可以说自定义版本号】 当前路径</span><br></pre></td></tr></table></figure>
<h4 id="docker-build命令"><a href="#docker-build命令" class="headerlink" title="docker build命令"></a><code>docker build</code>命令</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker build -f /home/dockerfile_01 -t yulium/centos:1.0 .</span><br><span class="line"><span class="comment"># 略</span></span><br></pre></td></tr></table></figure>
<div class="note success no-icon flat"><p>命令行后面要加<code>.</code> 否则报错了<br>注意：这里的<code>.</code>表示在当前路径<br>实际上<code>.</code>指的是在指定上下文目录，<code>docker build</code> 命令会将该目录下的内容打包交给<code>docker引擎</code>以帮助构建镜像</p>
</div>

<h4 id="启动自己写的容器"><a href="#启动自己写的容器" class="headerlink" title="启动自己写的容器"></a>启动自己写的容器</h4><h5 id="用法-1"><a href="#用法-1" class="headerlink" title="用法"></a>用法</h5><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it 镜像ID /bin/bash</span><br></pre></td></tr></table></figure>
<h5 id="运行容器"><a href="#运行容器" class="headerlink" title="运行容器"></a>运行容器</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -it yulium/centos:1.0 /bin/bash</span><br><span class="line"><span class="comment"># [root@70c4952c9d31 /]#</span></span><br></pre></td></tr></table></figure>
<h4 id="查看数据卷"><a href="#查看数据卷" class="headerlink" title="查看数据卷"></a>查看数据卷</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@70c4952c9d31 /]<span class="comment">#ls</span></span><br><span class="line"><span class="comment"># ......  volume01  volume02</span></span><br></pre></td></tr></table></figure>
<div class="note success no-icon flat"><p>说明：这个目录就是我们生成镜像的时候自动挂载了，数据卷目录</p>
</div>
<div class="img-wrap"><div class="img-bg"><img class="img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/Snipaste_2023-08-29_11-36-01.png"/></div></div>

<h4 id="退出容器并查看Mounts"><a href="#退出容器并查看Mounts" class="headerlink" title="退出容器并查看Mounts"></a>退出容器并查看<code>Mounts</code></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect 70c49</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;Type&quot;</span>: <span class="string">&quot;volume&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;6de9a85175c3b9ece98df6251de50d80d2cc8ca96cfd4105bc0ab3d8f5bcac41&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Source&quot;</span>: <span class="string">&quot;/var/lib/docker/volumes/6de9a85175c3b9ece98df6251de50d80d2cc8ca96cfd4105bc0ab3d8f5bcac41/_data&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Destination&quot;</span>: <span class="string">&quot;volume01&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Mode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;RW&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">&quot;Propagation&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;Type&quot;</span>: <span class="string">&quot;volume&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;a419b8273b50f0e80de80de170dc372063ef6fa2be1e1ce18906bdb9150d97c2&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Source&quot;</span>: <span class="string">&quot;/var/lib/docker/volumes/a419b8273b50f0e80de80de170dc372063ef6fa2be1e1ce18906bdb9150d97c2/_data&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Destination&quot;</span>: <span class="string">&quot;volume02&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Mode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;RW&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">&quot;Propagation&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<div class="note success no-icon flat"><p>这个卷和宿主机都有一个同步的目录！匿名挂载一般都是放在宿主机里面<code>docker</code>目录路径下</p>
</div>


<h3 id="测试一下：宿主机和容器的文件是否同步了"><a href="#测试一下：宿主机和容器的文件是否同步了" class="headerlink" title="测试一下：宿主机和容器的文件是否同步了"></a>测试一下：宿主机和容器的文件是否同步了</h3><p>首先，在自己的容器<code>volume01</code>目录下创建文件</p>
<h4 id="创建container-txt文件"><a href="#创建container-txt文件" class="headerlink" title="创建container.txt文件"></a>创建<code>container.txt</code>文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@0e5c1292b3af /]<span class="comment"># touch volume01/container.txt</span></span><br></pre></td></tr></table></figure>
<h4 id="查看宿主机volume01目录路径"><a href="#查看宿主机volume01目录路径" class="headerlink" title="查看宿主机volume01目录路径"></a>查看<code>宿主机volume01</code>目录路径</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 退出容器之后，查看有没有同步了</span></span><br><span class="line"><span class="comment"># 如果不知道此路径，可以通过命令docker inspect 容器ID查看Mounts内容</span></span><br><span class="line"><span class="built_in">cd</span> /var/lib/docker/volumes/fb5c70144ee9a27bfbb67e589ae9e7f95e8a013bbea03ac887bda69395f23665/_data</span><br></pre></td></tr></table></figure>
<h4 id="切换路径后用ls查看"><a href="#切换路径后用ls查看" class="headerlink" title="切换路径后用ls查看"></a>切换路径后用<code>ls</code>查看</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span></span><br><span class="line"><span class="comment"># container.txt</span></span><br></pre></td></tr></table></figure>
<div class="note success no-icon flat"><p>说明，文件同步了<br>这种方式以后使用太多了，因为我们通常会构建自己的镜像！<br>假如构建镜像时候没有挂载卷，要手动镜像挂载<code>-v 卷名:容器内路径</code></p>
</div>




<h2 id="初识Dockerfile"><a href="#初识Dockerfile" class="headerlink" title="初识Dockerfile"></a>初识Dockerfile</h2><p><code>命令脚本</code> -&gt; <code>构建镜像</code>  -&gt; <code>启动容器</code> -&gt; <code>查看</code><br><code>Dockerfile</code>就是用来构建docker镜像的<code>构建文件</code>和<code>命令脚本</code>，它就是一个命令脚本的文本文件，文本内容包含了一条条构建镜像所需的指令和说明。</p>
<p>基于<code>Dockerfile</code>构建镜像可以使用<code>docker build</code>命令。<code>docker build</code>命令中使用 <code>-f</code> 可以指定具体的<code>dockerfile文件</code></p>
<p>默认情况下使用<code>Dockerfile</code>（D大写），<code>docker build</code>命令中不用指定就可以构建</p>
<p>构建步骤：</p>
<ol>
<li>编写一个<code>dockerfile</code>文件<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -f /home/docker-test-volume/dockerfile1  -t yulium/centos .</span><br></pre></td></tr></table></figure></li>
<li><code>docker build</code> 构建成为一个<code>镜像</code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name docker01 yulium/centos</span><br></pre></td></tr></table></figure></li>
<li><code>docker run</code> 运行镜像</li>
<li><code>docker push</code>发布镜像(DockerHub、阿里云镜像仓库)</li>
</ol>
<p>很多官方镜像都像是基础包，很多功能都不具备，我们通常会自己搭建自己的镜像！</p>
<p>官方既然可以制作镜像，我们也一样可以做！</p>
<h2 id="Dockerfile构建过程"><a href="#Dockerfile构建过程" class="headerlink" title="Dockerfile构建过程"></a>Dockerfile构建过程</h2><h3 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h3><ol>
<li><p>每个保留关键字（指令）都是必须大写字母</p>
</li>
<li><p>执行从上到下顺序执行</p>
</li>
<li><p><code>#</code>表示注释</p>
</li>
<li><p>每个指令都会创建提交一个新的镜像层，并提交</p>
<div class="img-wrap"><div class="img-bg"><img class="img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/Snipaste_2023-08-29_15-06-27.png"/></div></div></li>
</ol>
<p><code>DockerFile</code>是<code>面向开发</code>的，我们以后要发布项目，做镜像，就需要编写<code>dockefile文件</code>，<code>这个文件十分简单</code>！</p>
<p>Docker镜像逐渐成为<code>企业的交互标准</code>，必须要掌握！</p>
<p>步骤：开发，部署， 运维… 缺一不可！</p>
<p><code>DockerFile</code>：构建文件，定义了一切的步骤，源代码</p>
<p><code>DockerImages</code>：通过DockerFile构建生成的镜像，最终发布和运行的产品！</p>
<p><code>docker build</code> <code>-f</code> &#x2F;dockerfile文件路径 <code>-t</code> 名称标签</p>
<p><code>Docker容器</code>：容器就是镜像运行起来提供服务器</p>
<h3 id="dockerfile指令"><a href="#dockerfile指令" class="headerlink" title="dockerfile指令"></a>dockerfile指令</h3><p>以前的话我们就是使用别人的，现在我们知道了这些指令之后，我们可以来练习自己写一个镜像</p>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="left">FROM</td>
<td align="left">基础镜像，一切从这里开始构建</td>
</tr>
<tr>
<td align="left">MAINTAINER</td>
<td align="left">镜像是谁写的，姓名+邮箱</td>
</tr>
<tr>
<td align="left">LABEL</td>
<td align="left">添加镜像的元数据，使用键值对的形式。</td>
</tr>
<tr>
<td align="left">RUN</td>
<td align="left">镜像构建的时候需要运行的命令</td>
</tr>
<tr>
<td align="left">CMD</td>
<td align="left">指定这个容器启动时运行的命令 例：CMD echo，只有最后一个会生效，可被替代（可以被覆盖）</td>
</tr>
<tr>
<td align="left">ENTRYPOINT</td>
<td align="left">指定这个容器启动的时候要运行的命令，可以追加命令（不可被覆盖）</td>
</tr>
<tr>
<td align="left">EXPOSE</td>
<td align="left">暴露的端口</td>
</tr>
<tr>
<td align="left">ENV</td>
<td align="left">构建的时候设置环境变量</td>
</tr>
<tr>
<td align="left">ADD</td>
<td align="left">将文件、目录或远程URL复制到镜像中</td>
</tr>
<tr>
<td align="left">COPY</td>
<td align="left">类似ADD，将我们的文件拷贝到镜像中</td>
</tr>
<tr>
<td align="left">VOLUME</td>
<td align="left">挂载的目录</td>
</tr>
<tr>
<td align="left">WORKDIR</td>
<td align="left">镜像的工作目录</td>
</tr>
<tr>
<td align="left">USER</td>
<td align="left">指定后续指令的用户上下文</td>
</tr>
<tr>
<td align="left">ARG</td>
<td align="left">定义在构建过程中传递给构建器的变量，可使用 “docker build” 命令设置</td>
</tr>
<tr>
<td align="left">ONBUILD</td>
<td align="left">当构建一个被继承的dockerfile的时候就会运行ONBUILD的指令。触发指令（了解即可）</td>
</tr>
<tr>
<td align="left">STOPSIGNAL</td>
<td align="left">设置发送给容器以退出的系统调用信号</td>
</tr>
<tr>
<td align="left">HEALTHCHECK</td>
<td align="left">定义周期性检查容器健康状态的命令</td>
</tr>
<tr>
<td align="left">SHELL</td>
<td align="left">覆盖Docker中默认的shell，用于RUN、CMD和ENTRYPOINT指令</td>
</tr>
</tbody></table>
<div class="img-wrap"><div class="img-bg"><img class="img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/Snipaste_2023-08-29_15-24-45.png"/></div></div>

<h4 id="FROM"><a href="#FROM" class="headerlink" title="FROM"></a>FROM</h4><p>基础镜像，必须是可以下载下来的,定制的镜像都是基于<code>FROM</code>的镜像，</p>
<p>比如用于<code>centos</code>就是定制需要的基础镜像。<br>后续的操作都是基于<code>centos</code>镜像</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">格式：</span><br><span class="line">  FROM <span class="language-xml"><span class="tag">&lt;<span class="name">image</span>&gt;</span></span></span><br><span class="line">  FROM <span class="language-xml"><span class="tag">&lt;<span class="name">image</span>&gt;</span></span>:<span class="language-xml"><span class="tag">&lt;<span class="name">tag</span>&gt;</span></span></span><br><span class="line">示例：</span><br><span class="line">  FROM nginx           默认版本号都是最新的</span><br><span class="line">  FROM nginx:1.25.1    指定版本号</span><br></pre></td></tr></table></figure>
<h4 id="MAINTAINER"><a href="#MAINTAINER" class="headerlink" title="MAINTAINER"></a>MAINTAINER</h4><p>用于指定镜像的维护者信息</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">格式：</span><br><span class="line">  MAINTAINER <span class="language-xml"><span class="tag">&lt;<span class="name">name</span>&gt;</span></span></span><br><span class="line">示例：</span><br><span class="line">  MAINTAINER yulium</span><br><span class="line">  MAINTAINER xxx@qq.com</span><br></pre></td></tr></table></figure>

<h4 id="LABEL"><a href="#LABEL" class="headerlink" title="LABEL"></a>LABEL</h4><p>用于向镜像添加元数据<code>metadata</code></p>
<p>指令用来给镜像添加一些元数据（metadata），</p>
<p>这些标签可以包含关于镜像的信息，如作者、版本、描述、维护者等</p>
<p><code>LABEL</code>指令是<code>可选</code>的</p>
<p>但它在构建镜像时为镜像添加了有用的描述性信息，有助于更好地管理和组织镜像库</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">以键值对的形式，格式:</span><br><span class="line">  LABEL <span class="language-xml"><span class="tag">&lt;<span class="name">key</span>&gt;</span></span>=<span class="language-xml"><span class="tag">&lt;<span class="name">value</span>&gt;</span></span> <span class="language-xml"><span class="tag">&lt;<span class="name">key</span>&gt;</span></span>=<span class="language-xml"><span class="tag">&lt;<span class="name">value</span>&gt;</span></span> <span class="language-xml"><span class="tag">&lt;<span class="name">key</span>&gt;</span></span>=<span class="language-xml"><span class="tag">&lt;<span class="name">value</span>&gt;</span></span> ...</span><br><span class="line">示例：</span><br><span class="line">  LABEL version=&quot;1.0&quot;,</span><br><span class="line">  LABEL &quot;description&quot;=&quot;This text&quot;</span><br><span class="line">  LABEL &quot;multi.label1&quot;=&quot;value1&quot; \</span><br><span class="line">  &quot;multi.label2&quot;=&quot;value2&quot;</span><br><span class="line">  LABEL &quot;other&quot;=&quot;value3&quot;</span><br></pre></td></tr></table></figure>
<p>如果要查看镜像的<code>labels</code>，可以使用<code>docker inspect</code>命令</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&quot;Labels&quot;: &#123;</span><br><span class="line"><span class="code">    &quot;version&quot;: &quot;1.0&quot;,</span></span><br><span class="line"><span class="code">    &quot;description&quot;: &quot;This text&quot;,</span></span><br><span class="line"><span class="code">    &quot;multi.label1&quot;: &quot;value1&quot;,</span></span><br><span class="line"><span class="code">    &quot;multi.label2&quot;: &quot;value2&quot;,</span></span><br><span class="line"><span class="code">    &quot;other&quot;: &quot;value3&quot;</span></span><br><span class="line"><span class="code">&#125;,</span></span><br></pre></td></tr></table></figure>
<div class="note success no-icon flat"><p>使用<code>LABEL</code>指令有更广泛的用途，可以用来添加更多类型的元数据信息，<br>而<code>MAINTAINER</code>指令<code>仅限于指定维护者信息</code>。<br>因此，如果你正在编写新的<code>Dockerfile</code>，建议使用<code>LABEL指令</code>来添加元数据信息，而避免使用过时的<code>MAINTAINER指令</code>。</p>
</div>

<h4 id="RUN"><a href="#RUN" class="headerlink" title="RUN"></a>RUN</h4><p>指定在构建正在创建的映像,比如安装软件，下载文件等<br>包含两种模式<code>Shell</code>和<code>exec</code></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">格式:</span><br><span class="line">  RUN <span class="language-xml"><span class="tag">&lt;<span class="name">command</span>&gt;</span></span> (shell模式，这个是最常用的，需要记住)</span><br><span class="line">示例：</span><br><span class="line">  RUN yum update &amp;&amp; yum install python3</span><br></pre></td></tr></table></figure>

<div class="note success no-icon flat"><p><code>RUN</code>指令在<code>Dockerfile</code>中可以出现多次,并且每个<code>RUN指令</code>都会创建一个新的镜像层<br>为了减少镜像的层数，可以将多个命令合并为一行<br>例如使用<code>&amp;&amp;</code>连接多个命令，这样在构建镜像时只会生成<code>一个新的层</code></p>
</div>

<h4 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h4><p>用于<code>docker run</code>执行<code>docker镜像</code>构建容器时使用<br>与<code>RUN</code>不同，它不会为<code>Image</code>创建新层，而只是运行命令,每个<code>Dockerfile/Image</code>只能有一个<code>CMD</code></p>
<ul>
<li>一个<code>Dockerfile</code>中只能包含一个<code>CMD指令</code></li>
<li>如果有多个<code>CMD</code>，则只有最后一个CMD指令会生效<div class="note success no-icon flat"><p>CMD [“a”,”b”] 格式：该格式是为<code>ENTRYPOINT</code>提供使用，此时<code>ENTRYPOINT</code>就必须使用<code>exec</code>格式，否则不生效</p>
</div>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">格式:</span><br><span class="line">  CMD <span class="language-xml"><span class="tag">&lt;<span class="name">command</span>&gt;</span></span></span><br><span class="line">示例：</span><br><span class="line">  CMD /bin/bash -c ls</span><br><span class="line">  CMD python ./app.py</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h5><p>此命令会在容器启动且<code>docker run</code>没有指定其他命令时运行。下面是一个例子：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CMD <span class="built_in">echo</span> <span class="string">&quot;Hello world&quot;</span></span><br></pre></td></tr></table></figure>
<p>运行容器 <code>docker run -it [image]</code> 将输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello world</span><br></pre></td></tr></table></figure>
<p>但当后面加上一个命令，比如 <code>docker run -it [image] /bin/bash</code>，<code>CMD</code> 会被忽略掉，命令<code>bash</code> 将被执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@10a32dc7d3d3:/<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>类似于<code>RUN</code>指令，用于运行程序，但二者运行的时间点不同:</p>
<ul>
<li><code>CMD</code>在<code>docker run</code>时运行</li>
<li><code>RUN</code>是在<code>docker build</code>构建镜像时运行的</li>
</ul>
<p>作用：<br>为启动的容器指定默认要运行的程序，程序运行结束，容器也就结束<br>CMD 指令指定的程序可被 docker run 命令行参数中指定要运行的程序所覆盖.</p>
<div class="note success no-icon flat"><p>使用<code>CMD指令</code>可以为镜像定义一个默认的启动命令</p>
<p>当使用<code>docker run</code>命令启动容器时，如果没有指定其他命令，就会执行<code>CMD中定义的命令</code>。</p>
<p>这使得在创建容器时无需手动指定要运行的命令，从而使容器的使用更加简便。</p>
<p>如果在<code>docker run</code>命令中指定了其他命令，则会覆盖<code>CMD指令</code>中的默认命令</p>
<p>例如，如果在启动容器时执行以下命令，就会覆盖CMD中定义的默认启动命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dockerfile文件里面其中 CMD [&quot;python&quot;, &quot;app.py&quot;]</span></span><br><span class="line">docker run my_image python app_01.py</span><br></pre></td></tr></table></figure>
<p>在上面的例子中，容器会运行<code>python app_01.py</code>命令，而不是默认的<code>CMD指令中定义的命令</code>。</p>
</div>

<h4 id="ENTRYPOINT"><a href="#ENTRYPOINT" class="headerlink" title="ENTRYPOINT"></a>ENTRYPOINT</h4><p><code>ENTRYPOINT</code>是<code>Dockerfile</code>中的一个重要指令，用于配置容器启动时的默认执行命令。<br>它类似于<code>CMD指令</code>，但有一些关键的区别</p>
<p><code>ENTRYPOINT</code>指令的格式与<code>CMD</code>指令类似，可以使用<code>Shell格式</code>或<code>数组格式</code>，但在使用时，需要注意以下几点：</p>
<ul>
<li><code>ENTRYPOINT</code>指令的命令会在容器启动时始终执行，无论在<code>docker run</code>命令中<code>是否</code>指定了<code>其他命令</code>。它<code>不会被覆盖</code>，而是作为容器的主要执行命令</li>
<li>如果在<code>docker run</code>命令中指定了其他命令，这些命令将作为<code>ENTRYPOINT</code>指令的参数进行传递.也就是说，<code>ENTRYPOINT指令</code>中的命令将成为执行时的前缀</li>
</ul>
<p>注意：如果<code>Dockerfile</code> 中如果存在<code>多个ENTRYPOINT </code>指令，仅最后一个生效</p>
<p>下面是一个使用<code>ENTRYPOINT</code>指令的简单示例：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos:latest</span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;echo&quot;</span>, <span class="string">&quot;Hello&quot;</span>]</span></span><br></pre></td></tr></table></figure>
<p>如果我们构建该镜像并运行容器，不提供其他参数，那么容器启动后将输出<code>&quot;Hello&quot;</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker build -t my_image .</span><br><span class="line">$ docker run my_image</span><br><span class="line">Hello</span><br></pre></td></tr></table></figure>
<p>如果我们在运行容器时提供了其他参数，那么这些参数将作为<code>ENTRYPOINT</code>指令中命令的参数：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker run my_image <span class="string">&quot;World&quot;</span></span><br><span class="line">Hello World</span><br></pre></td></tr></table></figure>
<p>将Dockerfile修改为:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;/bin/echo&quot;</span>, <span class="string">&quot;Hello&quot;</span>]  </span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;world&quot;</span>]</span></span><br></pre></td></tr></table></figure>
<p>当容器通过<code>docker run -it [image]</code> 启动时，输出为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello world</span><br></pre></td></tr></table></figure>
<p>而如果通过<code>docker run -it [image] yuliums</code> 启动，输出依旧为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello yuliums</span><br></pre></td></tr></table></figure>
<div class="note success no-icon flat"><p><code>ENTRYPOINT</code> 中的参数始终会被使用，而 <code>CMD</code> 的额外参数可以在容器启动时动态替换掉。<br><code>ENTRYPOINT</code> 和 <code>CMD</code> <code>可以联合使用，ENTRYPOINT</code> 设置执行的命令，<code>CMD</code>传递参数</p>
</div>


<p><code>Dockerfile</code>中<code>RUN</code>，<code>CMD</code>和<code>ENTRYPOINT</code>都能够用于执行命令，下面是三者的主要用途：</p>
<ul>
<li><code>RUN</code>命令执行命令并创建新的镜像层，通常用于安装软件包</li>
<li><code>CMD</code>命令设置容器启动后默认执行的命令及其参数，但<code>CMD</code>设置的命令能够被<code>docker run</code>命令后面的命令行参数替换</li>
<li><code>ENTRYPOINT</code>配置容器启动时的执行命令(<code>不会被忽略，一定会被执行，即使运行 docker run时指定了其他命令</code>)</li>
</ul>
<div class="note success no-icon flat"><p>实际应用中，可以使用<code>ENTRYPOINT指令</code>来定义一个可执行的程序或脚本,<br>然后在容器启动时运行这个程序，并将Docker容器作为可执行应用来使用.<br>这样可以确保容器在运行时的行为是可预期的<br>而且可以将容器配置和执行逻辑完全封装在镜像内部，使得容器的使用更加方便和易于管理</p>
</div>

<h4 id="EXPOSE"><a href="#EXPOSE" class="headerlink" title="EXPOSE"></a>EXPOSE</h4><p>用于声明容器在运行时监听的网络端口<br>作用：</p>
<ul>
<li>帮助镜像使用者理解这个镜像服务的守护端口，以方便配置映射</li>
<li>在运行时使用随机端口映射时，也就是<code>docker run -p</code>时，会自动随机映射<code>EXPOSE</code>的端口</li>
<li>可以是一个或者多个端口，也可以指定多个<code>EXPOSE</code><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">格式:</span><br><span class="line">  EXPOSE &lt;端口1&gt; [&lt;端口2&gt;/<span class="language-xml"><span class="tag">&lt;<span class="name">protocol</span>&gt;</span></span>...]</span><br><span class="line">示例：</span><br><span class="line">  EXPOSE 80</span><br></pre></td></tr></table></figure>
上面的例子中，我们声明了容器将<code>监听80端口</code>,而<code>[&lt;port&gt;/&lt;protocol&gt;…]</code>则表示可选的协议类型，例如<code>TCP或UDP</code>等<br>但是需要注意的是，EXPOSE并不会实际上打开该端口，也不会进行端口映射,<br>在使用<code>docker run</code>命令启动容器时，如果需要通过主机访问容器的80端口,还需要使用<code>-p</code>选项来进行端口映射。<br>例子：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -p 8080:80 my_image</span><br></pre></td></tr></table></figure>
<div class="note success no-icon flat"><p>上述命令将容器的80端口映射到主机的8080端口，这样就可以通过访问主机的8080端口来访问容器的服务</p>
</div></li>
</ul>
<h4 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a>ENV</h4><p>用于设置环境变量</p>
<p>它允许在镜像构建过程中<code>设置环境变量</code>，这些环境变量将在<code>容器运行时</code>可用</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">格式:</span><br><span class="line">  ENV key=value    其中key是环境变量的名称，value是环境变量的值</span><br><span class="line">  ENV key value</span><br><span class="line">示例：</span><br><span class="line">  ENV MY<span class="emphasis">_NAME John Doe</span></span><br></pre></td></tr></table></figure>
<p>实例：可以使用多个ENV指令来设置多个环境变量</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置环境变量</span></span><br><span class="line"><span class="keyword">ENV</span> MY_NAME John Doe</span><br><span class="line"><span class="keyword">ENV</span> APP_HOME /app</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 创建目录并设置工作目录</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">mkdir</span> <span class="variable">$APP_HOME</span></span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> <span class="variable">$APP_HOME</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 复制应用程序到镜像中</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . .</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 在运行时输出环境变量</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;Hello, <span class="variable">$MY_NAME</span>&quot;</span></span></span><br></pre></td></tr></table></figure>
<p>我们使用了两个ENV指令来设置两个环境变量：<code>MY_NAME</code>和<code>APP_HOME</code><br>在镜像构建过程中，这些环境变量会被设置为指定的值<br>然后，在容器启动时，<code>CMD指令中</code>的命令将使用<code>$MY_NAME</code>环境变量的值输出问候语<br>在运行容器时，你可以通过<code>docker run</code>命令的<code>-e</code>选项来覆盖环境变量的值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -e MY_NAME=<span class="string">&quot;Alice&quot;</span> my_image</span><br></pre></td></tr></table></figure>
<p>上述命令将覆盖默认的<code>MY_NAME</code>环境变量值，容器将输出<code>&quot;Hello, Alice&quot;</code>。</p>
<h4 id="ADD"><a href="#ADD" class="headerlink" title="ADD"></a>ADD</h4><p>用于将文件、目录或远程URL复制到镜像中</p>
<p>它类似于<code>COPY指令</code>，但在功能上更强大</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">格式:</span><br><span class="line">  ADD source destination      source是要复制的源文件、目录或URL    destination是复制后的目标路径</span><br><span class="line"></span><br><span class="line">示例：</span><br><span class="line">  ADD app.py /app/</span><br></pre></td></tr></table></figure>

<p>除了复制文件和目录，ADD指令还支持自动解压缩<br>如果<code>source</code>是一个压缩文件（例如<code>.tar</code>、<code>.tar.gz</code>、<code>.tgz</code>、<code>.zip</code>等）<br>那么ADD指令会<code>自动解压缩</code>该文件到destination指定的目录</p>
<p>实例：<br>复制本地文件到镜像中</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD</span><span class="language-bash"> app.py /app/</span></span><br></pre></td></tr></table></figure>
<p>复制本地目录到镜像中</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD</span><span class="language-bash"> src/ /app/</span></span><br></pre></td></tr></table></figure>
<p>从远程URL下载文件并复制到镜像中</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD</span><span class="language-bash"> https://example.com/file.tar.gz /tmp/</span></span><br></pre></td></tr></table></figure>
<p>解压缩压缩文件并复制到镜像中</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD</span><span class="language-bash"> app.tar.gz /app/</span></span><br></pre></td></tr></table></figure>

<h4 id="COPY"><a href="#COPY" class="headerlink" title="COPY"></a>COPY</h4><p>COPY用于将本地文件或目录复制到镜像中<br>它<code>不支持</code>自动解压缩功能，与ADD指令相比，功能更简单明确</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">格式:</span><br><span class="line">  COPY source destination      source是要复制的源文件、目录    destination是复制后的目标路径</span><br><span class="line"></span><br><span class="line">示例：</span><br><span class="line">  COPY app.py /app/</span><br></pre></td></tr></table></figure>
<p>复制本地文件到镜像中</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="language-bash"> app.py /app/</span></span><br></pre></td></tr></table></figure>

<p>复制本地目录到镜像中</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ADD</span><span class="language-bash"> src/ /app/</span></span><br></pre></td></tr></table></figure>
<div class="note success no-icon flat"><p>COPY指令会将本地文件或目录复制到镜像中的指定位置</p>
<p>在构建镜像时，Docker将会在镜像的文件系统层中添加复制的文件或目录</p>
<p>这使得镜像的构建过程更加明确，不会产生自动解压缩的<code>不确定行为</code></p>
<p>相对于<code>ADD指令</code>，<code>COPY指令更为推荐</code>，特别是在只需要<code>简单复制本地文件或目录</code>的情况下</p>
<p><code>COPY指令</code>功能简单，不容易引起不必要的意外行为</p>
<p>对于大多数复制文件的场景，建议使用<code>COPY指令</code></p>
</div>

<h4 id="VOLUME"><a href="#VOLUME" class="headerlink" title="VOLUME"></a>VOLUME</h4><p>用于声明容器中的挂载点（数据卷）</p>
<p>在启动容器<code>docker run</code>的时候，我们可以通过<code>-v</code>参数修改挂载点。</p>
<p>可以在一个<code>Dockerfile</code>中使用<code>多个VOLUME</code>指令来声明多个挂载点</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">格式:</span><br><span class="line">  VOLUME [&quot;&lt;路径1&gt;&quot;, &quot;&lt;路径2&gt;&quot; ...]</span><br><span class="line">  VOLUME [&quot;&lt;路径1&gt;&quot;]                   其中&lt;路径1&gt;是挂载点的路径</span><br><span class="line">示例：</span><br><span class="line">  VOLUME [&quot;/app/data&quot;, &quot;/app/logs&quot;]    声明两个挂载点</span><br></pre></td></tr></table></figure>
<p>在运行容器时，可以使用<code>-v</code>选项或<code>--mount</code>选项来将主机的目录或数据卷映射到容器的挂载点。<br>例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -v /host/data:/app/data -v /host/logs:/app/logs my_image</span><br></pre></td></tr></table></figure>
<div class="note success no-icon flat"><p>上述命令将主机的<code>/host/data</code>和<code>/host/logs</code>目录分别映射到容器中的<code>/app/data</code>和<code>/app/logs</code>挂载点，实现了主机和容器之间的数据共享</p>
</div>

<h4 id="WORKDIR"><a href="#WORKDIR" class="headerlink" title="WORKDIR"></a>WORKDIR</h4><p>用于设置工作目录，也称为当前工作目录 </p>
<p>在容器启动时，进程的当前工作目录将被设置为<code>WORKDIR指令</code>所指定的目录<code>必须是提前创建好的</code></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">格式:</span><br><span class="line">  WORKDIR &lt;工作目录路径&gt;</span><br><span class="line">示例：</span><br><span class="line">  WORKDIR /app</span><br></pre></td></tr></table></figure>
<div class="note success no-icon flat"><p>当容器启动时，进程的当前工作目录将自动设置为<code>/app</code>，<br>这样在执行CMD指令时，不需要<code>使用绝对路径</code>来运行<code>python app.py</code></p>
</div>

<h4 id="USER"><a href="#USER" class="headerlink" title="USER"></a>USER</h4><p>用于指定在容器中运行镜像时要使用的<code>普通用户</code></p>
<p>这边只是切换后续命令执行的用户（用户和用户组必须提前已经存在）</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">格式:</span><br><span class="line">  USER &lt;用户名&gt;[:&lt;用户组&gt;]</span><br><span class="line">示例：</span><br><span class="line">  USER myuser</span><br><span class="line">  USER user:group </span><br></pre></td></tr></table></figure>

<p>默认情况下，<code>Docker容器</code>在启动时以<code>root用户身份</code>运行,这意味着容器内的进程具有最高权限.</p>
<p>然而，为了加强安全性，避免潜在的安全风险，最好以非特权用户的身份运行容器中的应用程序<br>实例</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个新用户并切换到该用户</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> useradd -ms /bin/bash myuser</span></span><br><span class="line"><span class="keyword">USER</span> myuser</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 设置工作目录</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 复制应用程序到工作目录</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . .</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 设置环境变量</span></span><br><span class="line"><span class="keyword">ENV</span> APP_ENV production</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 容器启动时运行的命令</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;python&quot;</span>, <span class="string">&quot;app.py&quot;</span>]</span></span><br></pre></td></tr></table></figure>
<div class="note success no-icon flat"><p>在上面的例子中，我们使用<code>useradd</code>命令创建了一个名为<code>myuser的新用户</code>，并使用<code>-ms /bin/bash</code>选项指定了创建用户时使用的<code>shell</code>。</p>
<p>然后，通过<code>USER指令</code>切换到了<code>myuser用户</code>。</p>
<p>这样，在容器运行时，进程将以<code>myuser用户</code>的身份运行，而不是以<code>root用户</code>身份。</p>
</div>


<h4 id="ARG"><a href="#ARG" class="headerlink" title="ARG"></a>ARG</h4><p>无论何种编程语言或脚本中，都不可避免的会应用到变量<br>用于定义变量,仅在建造当前镜像的过程中<code>包括CMD和ENTRYPOINT有效</code>，而要是镜像被创建了和运行容器之后，是作用失效了</p>
<h5 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h5><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">格式:</span><br><span class="line">  ARG  <span class="language-xml"><span class="tag">&lt;<span class="name">name</span>&gt;</span></span>[=<span class="language-xml"><span class="tag">&lt;<span class="name">default</span> <span class="attr">value</span>&gt;</span></span>]</span><br><span class="line">示例：</span><br><span class="line">  ARG user1</span><br><span class="line">  ARG user2=hello</span><br></pre></td></tr></table></figure>
<p>如果你在<code>Dockerfile</code>中使用了<code>ARG但并未给定初始值</code>，则在运行<code>docker build（编译）</code>的时候未指定该<code>ARG变量</code>，则会<code>失败</code>。</p>
<p>若<code>ARG指令</code>具有默认值，并且在构建时<code>没有传递值</code>，则构建器将使用<code>默认值</code></p>
<p>虽然其在容器启动后不再生效，但是不建议使用构建时变量来传递诸如<code>github密钥</code>、<code>用户凭据</code>等<code>机密信息</code>。<br>因为使用<code>docker history</code>命令，镜像的任何用户都可以看到构建时的变量值。</p>
<h5 id="ARG-变量应用"><a href="#ARG-变量应用" class="headerlink" title="ARG 变量应用"></a><code>ARG</code> 变量应用</h5><p> 可以使用<code>ARG</code>和<code>ENV</code>指令为<code>RUN指令</code>指定参数。<br> 使用<code>ENV指令</code>定义的环境变量会覆盖<code>ARG指令</code>定义的<code>同名变量</code></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"><span class="keyword">ARG</span> CONT_IMG_VER</span><br><span class="line"><span class="keyword">ENV</span> CONT_IMG_VER=v1.<span class="number">0.0</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">echo</span> <span class="variable">$CONT_IMG_VER</span></span></span><br></pre></td></tr></table></figure>

<h3 id="实战测试"><a href="#实战测试" class="headerlink" title="实战测试"></a>实战测试</h3><h4 id="创建一个自己的centos"><a href="#创建一个自己的centos" class="headerlink" title="创建一个自己的centos"></a>创建一个自己的centos</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:~<span class="comment"># cd /homet</span></span><br><span class="line">root@localhost:/home<span class="comment"># mkdir dockerfile</span></span><br><span class="line">root@localhost:/home<span class="comment"># cd dockerfile/</span></span><br><span class="line">root@localhost:/home/dockerfile<span class="comment"># vim mydockerfile</span></span><br><span class="line"><span class="comment"># 编写mydockerfile文件</span></span><br><span class="line">root@localhost:/home/dockerfile<span class="comment"># cat mydockerfile</span></span><br><span class="line"><span class="comment"># 基于centos镜像创建</span></span><br><span class="line">FROM centos                        </span><br><span class="line"><span class="comment"># 镜像是谁写的，名字+邮箱      </span></span><br><span class="line">MAINTAINER yulium&lt;123@163.com&gt;           </span><br><span class="line"><span class="comment"># 设置环境路径</span></span><br><span class="line">ENV MYPATH /usr/loacl</span><br><span class="line"><span class="comment"># 切换到当前工作目录</span></span><br><span class="line">WORKDIR <span class="variable">$MYPATH</span></span><br><span class="line"><span class="comment">#安装vim编辑器</span></span><br><span class="line">RUN yum -y install vim                 </span><br><span class="line"><span class="comment">#安装ifconfig命令</span></span><br><span class="line">RUN yum -y install net-tools            </span><br><span class="line"></span><br><span class="line"><span class="comment">#暴露80端口</span></span><br><span class="line">EXPOSE 80                                </span><br><span class="line"></span><br><span class="line">CMD <span class="built_in">echo</span> <span class="variable">$MYPATH</span></span><br><span class="line">CMD <span class="built_in">echo</span> <span class="string">&quot;----end----&quot;</span></span><br><span class="line">CMD /bin/bash</span><br><span class="line">root@localhost:/home/dockerfile<span class="comment">#</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="通过这个文件构建镜像"><a href="#通过这个文件构建镜像" class="headerlink" title="通过这个文件构建镜像"></a>通过这个文件构建镜像</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -f mydockerfile(dockerfile 文件路径) -t 镜像名：[tag]</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@localhost:/home/dockerfile<span class="comment"># docker build -f mydockerfile -t yulium/centos:0.1 .</span></span><br></pre></td></tr></table></figure>
<p>如果报错信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dokcer给Centos配置时出现ERROR: failed to solve: process <span class="string">&quot;/bin/sh -c yum -y install vim&quot;</span> did not complete s</span><br></pre></td></tr></table></figure>
<p>原因：是因为Docker默认拉取的是centos最新版，此时需要我们指定一下拉取的版本就比如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull docker pull centos:7.9.2009</span><br></pre></td></tr></table></figure>
<p>解决问题：<br>在我们的Dockerfile文件中编写</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#基于centos镜像创建</span></span><br><span class="line">FROM centos:7                 </span><br><span class="line"><span class="comment">#镜像是谁写的，名字+邮箱      </span></span><br><span class="line">MAINTAINER yulium&lt;123@163.com&gt;           </span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置环境路径</span></span><br><span class="line">ENV MYPATH /usr/loacl</span><br><span class="line"><span class="comment"># 切换到当前工作目录</span></span><br><span class="line">WORKDIR <span class="variable">$MYPATH</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#安装vim编辑器</span></span><br><span class="line">RUN yum -y install vim                 </span><br><span class="line"><span class="comment">#安装ifconfig命令</span></span><br><span class="line">RUN yum -y install net-tools            </span><br><span class="line"></span><br><span class="line"><span class="comment">#暴露80端口</span></span><br><span class="line">EXPOSE 80                                </span><br><span class="line"></span><br><span class="line">CMD <span class="built_in">echo</span> <span class="variable">$MYPATH</span></span><br><span class="line">CMD <span class="built_in">echo</span> <span class="string">&quot;----end----&quot;</span></span><br><span class="line">CMD /bin/bash</span><br></pre></td></tr></table></figure>

<h4 id="查看镜像"><a href="#查看镜像" class="headerlink" title="查看镜像"></a>查看镜像</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br><span class="line"><span class="comment"># REPOSITORY      TAG       IMAGE ID       CREATED         SIZE</span></span><br><span class="line"><span class="comment"># yulium/centos   latest    3bc65dff503e   4 minutes ago   668MB</span></span><br><span class="line"><span class="comment"># centos          latest    5d0da3dc9764   23 months ago   231MB</span></span><br></pre></td></tr></table></figure>

<h4 id="运行容器-1"><a href="#运行容器-1" class="headerlink" title="运行容器"></a>运行容器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -it 3bc65dff503e</span><br><span class="line"><span class="comment"># [root@6d868b72593b local]#</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@6d868b72593b <span class="built_in">local</span>]<span class="comment"># pwd</span></span><br><span class="line"><span class="comment"># #/usr/local</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@6d868b72593b <span class="built_in">local</span>]<span class="comment"># ifconfig</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.17.0.2  netmask 255.255.0.0  broadcast 172.17.255.255</span><br><span class="line">        ether 02:42:ac:11:00:02  txqueuelen 0  (Ethernet)</span><br><span class="line">        RX packets 10  bytes 796 (796.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure>

<div class="note success no-icon flat"><p>这个原生centos和上面自己的镜像对比：进去之后是根目录，没有ifconfig、vim</p>
</div>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@6d868b72593b <span class="built_in">local</span>]<span class="comment"># exit</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">root@localhost:/home/dockerfile<span class="comment"># docker run -it 5d0da3dc9764</span></span><br><span class="line">[root@3db43b195f6c /]<span class="comment"># pwd</span></span><br><span class="line">/</span><br><span class="line">[root@3db43b195f6c /]<span class="comment"># ifconfig</span></span><br><span class="line">bash: ifconfig: <span class="built_in">command</span> not found</span><br><span class="line">[root@3db43b195f6c /]<span class="comment"># vim</span></span><br><span class="line">bash: vim: <span class="built_in">command</span> not found</span><br><span class="line">[root@3db43b195f6c /]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h4 id="列出本地进行的变更历史"><a href="#列出本地进行的变更历史" class="headerlink" title="列出本地进行的变更历史"></a>列出本地进行的变更历史</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">history</span> 3bc</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">IMAGE          CREATED          CREATED BY                                      SIZE      COMMENT</span><br><span class="line">3bc65dff503e   15 minutes ago   CMD [<span class="string">&quot;/bin/sh&quot;</span> <span class="string">&quot;-c&quot;</span> <span class="string">&quot;/bin/bash&quot;</span>]                0B        buildkit.dockerfile.v0</span><br><span class="line">&lt;missing&gt;      15 minutes ago   CMD [<span class="string">&quot;/bin/sh&quot;</span> <span class="string">&quot;-c&quot;</span> <span class="string">&quot;echo \&quot;----end----\&quot;&quot;</span>]     0B        buildkit.dockerfile.v0</span><br><span class="line">&lt;missing&gt;      15 minutes ago   CMD [<span class="string">&quot;/bin/sh&quot;</span> <span class="string">&quot;-c&quot;</span> <span class="string">&quot;echo <span class="variable">$MYPATH</span>&quot;</span>]             0B        buildkit.dockerfile.v0</span><br><span class="line">&lt;missing&gt;      15 minutes ago   EXPOSE map[80/tcp:&#123;&#125;]                           0B        buildkit.dockerfile.v0</span><br><span class="line">&lt;missing&gt;      15 minutes ago   RUN /bin/sh -c yum -y install net-tools <span class="comment"># bu…   190MB     buildkit.dockerfile.v0</span></span><br><span class="line">&lt;missing&gt;      15 minutes ago   RUN /bin/sh -c yum -y install vim <span class="comment"># buildkit    274MB     buildkit.dockerfile.v0</span></span><br><span class="line">&lt;missing&gt;      17 minutes ago   WORKDIR /usr/loacl                              0B        buildkit.dockerfile.v0</span><br><span class="line">&lt;missing&gt;      17 minutes ago   ENV MYPATH=/usr/loacl                           0B        buildkit.dockerfile.v0</span><br><span class="line">&lt;missing&gt;      17 minutes ago   MAINTAINER yulium&lt;123@163.com&gt;                  0B        buildkit.dockerfile.v0</span><br><span class="line">&lt;missing&gt;      23 months ago    /bin/sh -c <span class="comment">#(nop)  CMD [&quot;/bin/bash&quot;]            0B</span></span><br><span class="line">&lt;missing&gt;      23 months ago    /bin/sh -c <span class="comment">#(nop)  LABEL org.label-schema.sc…   0B</span></span><br><span class="line">&lt;missing&gt;      23 months ago    /bin/sh -c <span class="comment">#(nop) ADD file:b3ebbe8bd304723d4…   204MB</span></span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/avatar.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/avatar.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">鱼六秒</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://blog.sunguotao.shop/posts/eb2df35a.html">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://blog.sunguotao.shop/posts/eb2df35a.html')">【Docker 学习十】DockerFile</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://blog.sunguotao.shop/posts/eb2df35a.html"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=【Docker 学习十】DockerFile&amp;url=http://blog.sunguotao.shop/posts/eb2df35a.html&amp;pic=/img/bg.jpg" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://blog.sunguotao.shop" target="_blank">鱼六秒</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/Docker/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Docker<span class="tagsPageCount">14</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="/img/bg.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/c4d96bce.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/bg.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">【Dart 学习 二】数字Number</div></div></a></div><div class="next-post pull-right"><a href="/posts/7243bc6d.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/bg.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">【Docker 学习十三】Docker Compose</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/posts/607d9022.html" title="【Docker 学习四】常用容器命令详解"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/bg.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-04-03</div><div class="title">【Docker 学习四】常用容器命令详解</div></div></a></div><div><a href="/posts/3a5a0c82.html" title="【Docker 学习五】Docker安装nginx挂载"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/bg.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-04-03</div><div class="title">【Docker 学习五】Docker安装nginx挂载</div></div></a></div><div><a href="/posts/7243bc6d.html" title="【Docker 学习十三】Docker Compose"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/bg.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-04-03</div><div class="title">【Docker 学习十三】Docker Compose</div></div></a></div><div><a href="/posts/5e3d6236.html" title="【Docker 学习二】安装与卸载"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/bg.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-08-19</div><div class="title">【Docker 学习二】安装与卸载</div></div></a></div><div><a href="/posts/a91bc5fb.html" title="【Docker 学习一】概念"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/bg.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-08-19</div><div class="title">【Docker 学习一】概念</div></div></a></div><div><a href="/posts/3fb946b9.html" title="【Docker 学习八】docker具名和匿名挂载"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/bg.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-04-03</div><div class="title">【Docker 学习八】docker具名和匿名挂载</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description">Python软件开发,记录生活</div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%93%E9%AA%8C%E4%B8%80%E4%B8%8B"><span class="toc-number">1.</span> <span class="toc-text">体验一下</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAdockerfile01%E6%96%87%E4%BB%B6"><span class="toc-number">1.1.</span> <span class="toc-text">创建dockerfile01文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E5%86%99dockerfile01"><span class="toc-number">1.2.</span> <span class="toc-text">编写dockerfile01</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F%EF%BC%9Adocker-build%E5%91%BD%E4%BB%A4"><span class="toc-number">1.3.</span> <span class="toc-text">构建镜像：docker build命令:</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E6%B3%95"><span class="toc-number">1.3.1.</span> <span class="toc-text">用法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#docker-build%E5%91%BD%E4%BB%A4"><span class="toc-number">1.3.2.</span> <span class="toc-text">docker build命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E8%87%AA%E5%B7%B1%E5%86%99%E7%9A%84%E5%AE%B9%E5%99%A8"><span class="toc-number">1.3.3.</span> <span class="toc-text">启动自己写的容器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%94%A8%E6%B3%95-1"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">用法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">运行容器</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">1.3.4.</span> <span class="toc-text">查看数据卷</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%80%E5%87%BA%E5%AE%B9%E5%99%A8%E5%B9%B6%E6%9F%A5%E7%9C%8BMounts"><span class="toc-number">1.3.5.</span> <span class="toc-text">退出容器并查看Mounts</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E4%B8%80%E4%B8%8B%EF%BC%9A%E5%AE%BF%E4%B8%BB%E6%9C%BA%E5%92%8C%E5%AE%B9%E5%99%A8%E7%9A%84%E6%96%87%E4%BB%B6%E6%98%AF%E5%90%A6%E5%90%8C%E6%AD%A5%E4%BA%86"><span class="toc-number">1.4.</span> <span class="toc-text">测试一下：宿主机和容器的文件是否同步了</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAcontainer-txt%E6%96%87%E4%BB%B6"><span class="toc-number">1.4.1.</span> <span class="toc-text">创建container.txt文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%AE%BF%E4%B8%BB%E6%9C%BAvolume01%E7%9B%AE%E5%BD%95%E8%B7%AF%E5%BE%84"><span class="toc-number">1.4.2.</span> <span class="toc-text">查看宿主机volume01目录路径</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%87%E6%8D%A2%E8%B7%AF%E5%BE%84%E5%90%8E%E7%94%A8ls%E6%9F%A5%E7%9C%8B"><span class="toc-number">1.4.3.</span> <span class="toc-text">切换路径后用ls查看</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9D%E8%AF%86Dockerfile"><span class="toc-number">2.</span> <span class="toc-text">初识Dockerfile</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Dockerfile%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B"><span class="toc-number">3.</span> <span class="toc-text">Dockerfile构建过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">3.1.</span> <span class="toc-text">基础知识</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dockerfile%E6%8C%87%E4%BB%A4"><span class="toc-number">3.2.</span> <span class="toc-text">dockerfile指令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#FROM"><span class="toc-number">3.2.1.</span> <span class="toc-text">FROM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MAINTAINER"><span class="toc-number">3.2.2.</span> <span class="toc-text">MAINTAINER</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LABEL"><span class="toc-number">3.2.3.</span> <span class="toc-text">LABEL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RUN"><span class="toc-number">3.2.4.</span> <span class="toc-text">RUN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CMD"><span class="toc-number">3.2.5.</span> <span class="toc-text">CMD</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4"><span class="toc-number">3.2.5.1.</span> <span class="toc-text">命令</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ENTRYPOINT"><span class="toc-number">3.2.6.</span> <span class="toc-text">ENTRYPOINT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#EXPOSE"><span class="toc-number">3.2.7.</span> <span class="toc-text">EXPOSE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ENV"><span class="toc-number">3.2.8.</span> <span class="toc-text">ENV</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ADD"><span class="toc-number">3.2.9.</span> <span class="toc-text">ADD</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#COPY"><span class="toc-number">3.2.10.</span> <span class="toc-text">COPY</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#VOLUME"><span class="toc-number">3.2.11.</span> <span class="toc-text">VOLUME</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#WORKDIR"><span class="toc-number">3.2.12.</span> <span class="toc-text">WORKDIR</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#USER"><span class="toc-number">3.2.13.</span> <span class="toc-text">USER</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ARG"><span class="toc-number">3.2.14.</span> <span class="toc-text">ARG</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95"><span class="toc-number">3.2.14.1.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ARG-%E5%8F%98%E9%87%8F%E5%BA%94%E7%94%A8"><span class="toc-number">3.2.14.2.</span> <span class="toc-text">ARG 变量应用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E6%B5%8B%E8%AF%95"><span class="toc-number">3.3.</span> <span class="toc-text">实战测试</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E8%87%AA%E5%B7%B1%E7%9A%84centos"><span class="toc-number">3.3.1.</span> <span class="toc-text">创建一个自己的centos</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E8%BF%99%E4%B8%AA%E6%96%87%E4%BB%B6%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F"><span class="toc-number">3.3.2.</span> <span class="toc-text">通过这个文件构建镜像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E9%95%9C%E5%83%8F"><span class="toc-number">3.3.3.</span> <span class="toc-text">查看镜像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8-1"><span class="toc-number">3.3.4.</span> <span class="toc-text">运行容器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%97%E5%87%BA%E6%9C%AC%E5%9C%B0%E8%BF%9B%E8%A1%8C%E7%9A%84%E5%8F%98%E6%9B%B4%E5%8E%86%E5%8F%B2"><span class="toc-number">3.3.5.</span> <span class="toc-text">列出本地进行的变更历史</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/a712b464.html" title="使用PDM来管理Python项目"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/bg.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用PDM来管理Python项目"/></a><div class="content"><a class="title" href="/posts/a712b464.html" title="使用PDM来管理Python项目">使用PDM来管理Python项目</a><time datetime="2024-04-26T12:33:25.000Z" title="发表于 2024-04-26 20:33:25">2024-04-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/6eefa259.html" title="搭建免费虚拟主机云服务器"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/badge/dwd.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="搭建免费虚拟主机云服务器"/></a><div class="content"><a class="title" href="/posts/6eefa259.html" title="搭建免费虚拟主机云服务器">搭建免费虚拟主机云服务器</a><time datetime="2024-04-03T08:50:43.096Z" title="发表于 2024-04-03 16:50:43">2024-04-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/e48960ca.html" title="博客文章链接优化之abbrlink"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/bg.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="博客文章链接优化之abbrlink"/></a><div class="content"><a class="title" href="/posts/e48960ca.html" title="博客文章链接优化之abbrlink">博客文章链接优化之abbrlink</a><time datetime="2024-04-03T08:50:43.096Z" title="发表于 2024-04-03 16:50:43">2024-04-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/a36982c8.html" title="外挂标签"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/bg.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="外挂标签"/></a><div class="content"><a class="title" href="/posts/a36982c8.html" title="外挂标签">外挂标签</a><time datetime="2024-04-03T08:50:43.093Z" title="发表于 2024-04-03 16:50:43">2024-04-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/7af4cd2e.html" title="【Docker 学习十二】利用dockerfile构建FastAPI容器"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/bg.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【Docker 学习十二】利用dockerfile构建FastAPI容器"/></a><div class="content"><a class="title" href="/posts/7af4cd2e.html" title="【Docker 学习十二】利用dockerfile构建FastAPI容器">【Docker 学习十二】利用dockerfile构建FastAPI容器</a><time datetime="2024-04-03T08:50:43.091Z" title="发表于 2024-04-03 16:50:43">2024-04-03</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" href="/atom.xml" title="RSS"><i class="anzhiyufont anzhiyu-icon-rss"></i></a><img class="footer_mini_logo" title="返回顶部" alt="返回顶部" onclick="anzhiyu.scrollToDest(0, 500)" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img02.anheyu.com/adminuploads/1/2023/05/09/645a3ff0dc540.gif" size="50px"/><a class="deal_link" target="_blank" rel="noopener" href="https://github.com" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div><div id="anzhiyu-footer"><div class="footer-group"><div class="footer-title">主题</div><div class="footer-links"><a class="footer-item" title="安知鱼" target="_blank" rel="noopener" href="https://blog.anheyu.com/categories/">安知鱼</a></div></div><div class="footer-group"><div class="footer-title-group"><div class="footer-title">友链</div><a class="random-friends-btn" id="footer-random-friends-btn" href="javascript:addFriendLinksInFooter();" title="换一批友情链接"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i></a></div><div class="footer-links" id="friend-links-in-footer"></div></div></div></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2024 By <a class="footer-bar-link" href="/" title="鱼六秒" target="_blank">鱼六秒</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a><a class="footer-bar-link" target="_blank" rel="noopener" href="https://beian.miit.gov.cn/" title="皖ICP备-xxxxxxx号">皖ICP备-xxxxxxx号</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">32</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">9</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">7</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://pan.anzhiy.cn/" title="alist文件管理"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="alist文件管理"/><span class="back-menu-item-text">alist文件管理</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blogtoolstation.github.io/" title="鱼六秒导航工具站"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="鱼六秒导航工具站"/><span class="back-menu-item-text">鱼六秒导航工具站</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/tools/"><span> 在线工具</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size: 0.9em;"></i><span> 我的装备</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Dart/" style="font-size: 0.88rem;">Dart<sup>3</sup></a><a href="/tags/Docker/" style="font-size: 0.88rem;">Docker<sup>14</sup></a><a href="/tags/FastAPI/" style="font-size: 0.88rem;">FastAPI<sup>1</sup></a><a href="/tags/Hexo/" style="font-size: 0.88rem; font-weight: 500; color: var(--anzhiyu-lighttext)">Hexo<sup>8</sup></a><a href="/tags/PDM/" style="font-size: 0.88rem;">PDM<sup>1</sup></a><a href="/tags/PicGo/" style="font-size: 0.88rem;">PicGo<sup>1</sup></a><a href="/tags/npm/" style="font-size: 0.88rem;">npm<sup>1</sup></a><a href="/tags/python/" style="font-size: 0.88rem;">python<sup>1</sup></a><a href="/tags/%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8/" style="font-size: 0.88rem;">云服务器<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><a id="switch-commentBarrage" href="javascript:anzhiyu.switchCommentBarrage();" title="开关弹幕"><i class="anzhiyufont anzhiyu-icon-danmu"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: '',
      region: '',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.cbd.int/twikoo@1.6.25/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: '',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"><script async src="/js/anzhiyu/comment_barrage.js"></script></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: '',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.cbd.int/twikoo@1.6.25/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>